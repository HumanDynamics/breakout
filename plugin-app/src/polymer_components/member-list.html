<dom-module id="member-list">

    <template>
        <template is="dom-repeat" items="{{talkers}}">
            <paper-card heading="{{item.talker}}" image="{{item.image}}">
                <div class="card-content">{{item.talker}}</div>
                <div class="card-actions">
                </div>
            </paper-card>
        </template>
    </template>

    <script>
     Polymer({
         is: "member-list",

         properties: {
             talkers: {
                 type: Array,
                 notify: true,
             },
         },
         
         ready: function() {
             this.conn = new Asteroid(window.meteorURL, true);
             this.conn.subscribe('talkers');
             this.talkers = [];
             this.talkerCollection = this.conn.getCollection('talkers');
             this.talkerRQ = this.talkerCollection.reactiveQuery({});

             var _this = this;
             
             // make the talkers array reactive
             this.talkerRQ.on("change", function () {
                 _this.talkers = _this.talkerRQ.result;
             });

             // hangout api
             gapi.hangout.onApiReady.add(function(eventObj) {

                 // create hangout object in server
                 
                 
                 // initialize users for this hangout
                 var users = gapi.hangout.getParticipants();
                 _this.updateUsers(gapi.hangout.getParticipants());

                 // update when they change
                 gapi.hangout.onEnabledParticipantsChanged.add(function() {
                     _this.updateUsers(gapi.hangout.getParticipants());
                 });

             });

         },

         // udpate the users in this hangout
         // gets called when users enter or leave.
         updateUsers: function(users) {
             var _this = this;
             for (var i = 0; i < users.length; i++) {
                 var u = users[i];
                 _this.talkerCollection.insert({
                     "talker": u.person.displayName,
                     "image": u.person.image.url,
                     "hangout_url": "testUrl", //gapi.hangout.getHangoutURL(),
                     "gid": u.person.id
                 });
             }
         },
         
     });
    </script>
</dom-module>
